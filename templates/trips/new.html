{% extends 'layouts/base.html' %}

{% block content %}
  <div class="h-screen bg-blue-50">
    <header class="flex justify-start bg-sky-800">
      <a class="px-2 py-2 text-white bg-sky-800 hover:bg-sky-950" href="{% url 'trips:index' %}"><i class="fa-solid fa-house-chimney"></i></a>
      <h1 class="px-2 py-2 text-white bg-sky-800">新增行程</h1>
    </header>
    <form action="{% url 'trips:add' %}" method="post" class="mt-8">
      {% csrf_token %}

      <div class="flex flex-col justify-center max-w-md min-h-full px-6 py-5 mx-auto lg:px-10 justify-self-start">
        <div class="mb-6">
          <div class="w-full pic">
            <label for="pic" class="block text-sm font-bold leading-6 text-cyan-800">封面照片</label>
            <img id="image" class="max-w-[370px] max-h-[200px]" src="https://picsum.photos/370/200" />
        </div>
          <form action="{% url 'trips:upload' %}" method="post" enctype="multipart/form-data">
          {% csrf_token %}
          <!-- 将上传图片按钮改为文件选择框 -->
          <input type="file" id="image-upload" style="display: none;">
          <!-- 给一个触发文件选择框的按钮 -->
          <button type="submit" class="px-4 py-2 mt-2 font-bold text-white rounded bg-sky-800 hover:bg-sky-950" onclick="document.getElementById('image-upload').click(); return false;">上傳圖片</button>
        </div>
        </form>

        <!-- 已上传图片显示 -->
        <div class="w-full mt-4">
          <div class="flex flex-wrap">
            {% for photo in photos %}
              <div class="m-2">
                <img src="{{ photo.image.url }}" alt="Photo" class="h-auto max-w-xs">
              </div>
            {% endfor %}
          </div>
        </div>
        <!-- 已上传图片显示结束 -->

        <div class="mb-6">
          <label for="name" class="block text-sm font-bold leading-6 text-cyan-800">行程名稱：</label>
          <input type="text" name="name" id="name" required="required" class="block w-full h-12 pl-1 mt-1 mb-3 border-gray-300 rounded-md shadow-sm form-input focus:border-indigo-600 focus:ring focus:ring-cyan-800 focus:ring-opacity-50" />
        </div>

        <div class="mb-6">
          <label for="start_date" class="block text-sm font-bold leading-6 text-cyan-800">出發日：</label>
          <input type="date" name="start_date" id="start_date" value="" required min="{% now 'Y-m-d' %}" class="block w-full h-12 pl-1 mt-1 mb-3 border-gray-300 rounded-md shadow-sm form-input focus:border-indigo-600 focus:ring focus:ring-cyan-800 focus:ring-opacity-50" />
        </div>

        <div class="mb-6">
          <label for="end_date" class="block text-sm font-bold leading-6 text-cyan-800">結束日：</label>
          <input type="date" name="end_date" id="end_date" value="" required min="{% now 'Y-m-d' %}" class="block w-full h-12 pl-1 mt-1 mb-3 border-gray-300 rounded-md shadow-sm form-input focus:border-indigo-600 focus:ring focus:ring-cyan-800 focus:ring-opacity-50" />
        </div>

        <div class="mb-6">
          <label for="transportation" class="block text-sm font-bold leading-6 text-cyan-800">交通方式：</label>
          <select class="block w-full h-12 pl-1 mt-1 mb-3 border-gray-300 rounded-md shadow-sm form-input focus:border-indigo-600 focus:ring focus:ring-cyan-800 focus:ring-opacity-50" name="transportation">
            <option value="">走路</option>
            <option value="">汽車</option>
            <option value="">機車</option>
            <option value="">大眾運輸</option>
          </select>
        </div>
      </div>
      <div class="flex justify-center">
        <button class="px-4 py-2 font-bold text-white rounded bg-sky-800 hover:bg-sky-950" type="submit">建立新行程</button>
      </div>
    </form>
  </div>

  <!-- JavaScript 监听文件选择框的变化 -->
  <script>
    document.getElementById('image-upload').addEventListener('change', function(event) {
      // 获取用户选择的文件
      const selectedFile = event.target.files[0];

      // 检查是否选择了文件
      if (selectedFile) {
        // 使用 FileReader 对象将文件转换为 base64 编码的 URL
        const reader = new FileReader();
        reader.onload = function(e) {
          // 将 base64 编码的 URL 设置为封面照片的 src 属性
          document.getElementById('image').src = e.target.result;
        };
        reader.readAsDataURL(selectedFile); // 将文件读取为 base64 编码的 URL
      }
    });
  </script>
{% endblock %}
